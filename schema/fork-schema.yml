$ref: '#/definitions/Course'
$schema: http://json-schema.org/draft-06/schema#
definitions:
    Course:
        type: object
        title: Course
        description: |
            Learning materials for a course
        additionalProperties: false
        properties:
            api_version:
                type: array
                items:
                    - type: integer
                      minimum: 1
                      maximum: 1
                    - type: integer
                      minimum: 1
                description: |
                    Version of the information, and of the schema,
                    as two integers â€“ [major, minor].
                    The minor version is increased on every change to the
                    schema that keeps backwards compatibility for forks
                    (i.e. input data).
                    The major version is increased on incompatible changes.
            title: {$ref: '#/definitions/title'}
            subtitle:
                type: string
                description: |
                    Human-readable subtitle, mainly used to distinguish several
                    runs of same-named courses.
                contentMediaType: text/plain  # XXX
            description:
                type: string
                description: |
                    Short description of the course (about one line).
                contentMediaType: text/plain  # XXX
            long_description:
                type: string
                description: |
                    Long description of the course (up to several paragraphs).
                contentMediaType: text/plain  # XXX
            place:
                type: string
                description: |
                    Textual description of where the course takes place.
                contentMediaType: text/plain  # XXX
            time:
                type: string
                description: |
                    Textual description of the time of day the course takes
                    place.
                contentMediaType: text/plain  # XXX
            default_time:
                type: object
                additionalProperties: false
                description: |
                    Default start/end times
                properties:
                    start: {$ref: '#/definitions/time'}
                    end: {$ref: '#/definitions/time'}
                required: [start, end]
            sessions:
                type: array
                items: {$ref: '#/definitions/Session'}
            vars: {$ref: '#/definitions/Vars'}
        required: [title, sessions]

    Vars:
        type: object
        title: vars
        description: |
            Variables for rendering a page of content.
            Values can be any JSON-serializable objects, and might be set
            from the lesson, course, page, or even overridden by the user.
        default: {}
        properties: {}
        examples:
            - {coach-present: true}

    Session:
        type: object
        title: Session
        description: |
            A smaller collection of teaching materials,
            usually used for one meeting of an in-preson course or
            a self-contained section of a longer workshop.
        additionalProperties: false
        properties:
            date:
                format: date
                type: string
                description: |
                    Date when this session is taught.
                    Missing for self-study materials.
            description:
                type: string
                contentMediaType: text/plain  # XXX
                description: |
                    Short description of the session, mainly used
                    in case the title is not sufficient.
            materials:
                type: array
                description: |
                    Teaching materials to be covered
                items: {$ref: '#/definitions/Material'}
            slug: {$ref: '#/definitions/slug'}
            title: {type: string}
        required: [title, slug, materials]

    Material:
        type: object
        title: Material
        description: |
            Teaching material.

            This might be:
            * A lesson on Naucse
            * An URL to content hosted elsewhere (e.g. to presentation slides,
              homework, video...)
            * An item without a link (e.g. an instructor-led activity with
              no supporting material for the students)
        additionalProperties: false
        properties:
            title: {$ref: '#/definitions/title'}
            type: {$ref: '#/definitions/material_type'}
            slug:
                type: string
                description: |
                    Slug of a lesson on naucse
            pages:
                type: object
                description: |
                    Individual lesson pages
                additionalProperties: {$ref: '#/definitions/Page'}
                required: [index]
            external_url:
                anyOf:
                - {type: 'null'}
                - {type: string, format: uri}
        required: [title]

        anyOf:
          - description: A lesson on Naucse
            required: [slug, pages]
          - description: Non-Naucse material
            allOf:
              - not: {required: ['pages']}

    Page:
        type: object
        title: Page
        additionalProperties: false
        description: |
            Page of content hosted on naucse
        properties:
            title: {$ref: '#/definitions/title'}
            slug: {$ref: '#/definitions/slug'}
            render_call: {$ref: '#/definitions/RenderCall'}
            attribution:
                type: array
                items:
                    type: string
                    contentMediaType: text/plain  # XXX
            license: {$ref: '#/definitions/License'}
            license_code: {$ref: '#/definitions/License'}
            vars: {$ref: '#/definitions/Vars'}
            url:
                type: string
                description: |
                    URL of the rendered content
                format: uri
                readOnly: true
        required: [title, slug, render_call, license]

    License:
        type: string
        title: License
        description: |
            Identifier of the licence under which content is available.

            Note that Naucse supports only a limited set of licences.
        enum: ["cc-by-sa-40", "cc0"]

    RenderCall:
        type: object
        title: RenderCall
        description: |
            Specification of how content is to be rendered.
        additionalProperties: false
        properties:
            entrypoint: {type: string}
            args:
                type: array
                default: []
            kwargs:
                type: object
                default: {}
        required: [entrypoint]
        writeOnly: true

    slug:
        type: string
        pattern: '^[-_a-zA-Z0-9]+$'

    lesson_slug:
        type: string
        pattern: '^[-_a-zA-Z0-9]+/[-_a-zA-Z0-9]+$'

    material_type:
        type: string
        examples:
            - lesson
            - link
            - special
            - homework
            - cheatsheet

    title:
        type: string
        description: |
            Human-readable title
        contentMediaType: text/plain  # XXX

    time:
        type: string
        pattern: '^[0-9]{2}:[0-9]{2}$'
